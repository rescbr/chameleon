TARGET_AS  = /usr/bin/as
TARGET_LD  = /usr/bin/ld
TARGET_CC  = /usr/bin/gcc-4.2
TARGET_CPP = /usr/bin/g++-4.2

NASM = $(shell which nasm) -p $(SRCROOT)/autoconf.inc

##### i386 Rules #####
$(OBJROOT)/%.${ARCH}o: %.c $(OBJROOT)
	@echo "\t[CC:I386] $<"
	@$(TARGET_CC) -arch ${ARCH}  $(CFLAGS) $(DEFINES) -c $(INC) $< -o $@ \
	    -MD -dependency-file $(OBJROOT)/$*.d
	@md -u $(OBJROOT)/Makedep -f -d $(OBJROOT)/$*.d

$(OBJROOT)/%.${ARCH}o: %.m $(OBJROOT)
	@echo "\t[M:I386] $<"
	@$(TARGET_CC) -arch ${ARCH} $(CFLAGS) $(DEFINES) -c $(INC) $< -o $@ \
	    -MD -dependency-file $(OBJROOT)/$*.d
	@md -u $(OBJROOT)/Makedep -f -d $(OBJROOT)/$*.d

$(OBJROOT)/%.${ARCH}o: %.cpp $(OBJROOT)
	@echo "\t[CPP:I386] $<"
	@$(TARGET_CPP) -arch ${ARCH} $(CPPFLAGS) $(CFLAGS) -c "$<" $(INC) -o $@ \
	    -MD -dependency-file $(OBJROOT)/$*.d
	@md -u $(OBJROOT)/Makedep -f -d $(OBJROOT)/$*.d

$(OBJROOT)/%.${ARCH}o: %.s
	@echo "\t[AS:I386] $<"
	@$(TARGET_CC) -arch ${ARCH} $(CPPFLAGS) -c $(INC) -o $@ $< \
		    -MD -dependency-file $*.d
	@md -u $(OBJROOT)/Makedep -f -d $*.d
	
$(OBJROOT)/boot2.${ARCH}o:
	@echo "\t[AS:I386] boot2.s"
	@$(TARGET_CC) -Wa,-n -c $(INC) -arch i386 -o $(OBJROOT)/$(@F) boot2.s \
		    -MD -dependency-file $*.d
	@md -u $(OBJROOT)/Makedep -f -d $*.d


ACTUAL_OBJECTS = $(addsuffix .${ARCH}o, $(addprefix $(OBJROOT)/, $(OBJECTS)))
MODULE_OBJECTS = $(addsuffix .${ARCH}o, $(addprefix $(OBJROOT)/, $(MODULE_OBJS)))